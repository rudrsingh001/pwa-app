<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spin Wheel</title>

  <style>
    body{
      margin:0;
      font-family: Arial, sans-serif;
      background:#f5f7fb;
      display:flex;
      justify-content:center;
      padding:18px;
    }
    .card{
      width:min(520px, 100%);
      background:#fff;
      border-radius:16px;
      box-shadow:0 10px 25px rgba(0,0,0,.12);
      padding:16px;
      text-align:center;
    }
    h2{margin:6px 0 4px;}
    .sub{margin:0 0 12px;color:#6b7280;font-size:13px;}
    .stage{
      position:relative;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:10px 0 6px;
    }
    canvas{
      width:min(420px, 92vw);
      height:min(420px, 92vw);
      max-width:420px;
      max-height:420px;
      display:block;
    }

    /* Arrow (top) */
    .arrow{
      position:absolute;
      top:-2px;
      left:50%;
      transform:translateX(-50%);
      width:0;height:0;
      border-left:14px solid transparent;
      border-right:14px solid transparent;
      border-top:26px solid #111827; /* dark arrow */
      filter: drop-shadow(0 6px 8px rgba(0,0,0,.25));
      z-index:5;
    }
    .arrow::after{
      content:"";
      position:absolute;
      left:-10px;
      top:-24px;
      width:0;height:0;
      border-left:10px solid transparent;
      border-right:10px solid transparent;
      border-top:18px solid #ef4444; /* red tip */
    }

    .btns{display:flex;gap:10px;justify-content:center;margin-top:12px;flex-wrap:wrap;}
    button{
      padding:12px 16px;
      border:none;
      border-radius:12px;
      font-weight:700;
      cursor:pointer;
    }
    #spinBtn{background:#0b66ff;color:#fff;min-width:160px;}
    #spinBtn:disabled{opacity:.6;cursor:not-allowed;}
    #resetBtn{background:#111827;color:#fff;}
    .result{
      margin-top:12px;
      padding:12px;
      border-radius:12px;
      background:#f1f5ff;
      border:1px solid #dbe7ff;
      font-size:16px;
      font-weight:800;
      color:#0b3ea8;
      min-height:22px;
    }
    .tiny{
      margin-top:10px;
      font-size:12px;
      color:#6b7280;
      line-height:1.4;
    }
    .pill{
      display:inline-block;
      padding:4px 10px;
      border-radius:999px;
      background:#fff;
      border:1px solid #e5e7eb;
      font-weight:700;
      color:#111827;
      margin-top:8px;
    }
  </style>
</head>

<body>
  <div class="card">
    <h2>Spin & Win ðŸŽ¡</h2>
    <p class="sub">Arrow pe jahan rukega â€” wahi prize milega âœ…</p>

    <div class="stage">
      <div class="arrow"></div>
      <canvas id="wheel" width="600" height="600"></canvas>
    </div>

    <div class="btns">
      <button id="spinBtn">SPIN</button>
      <button id="resetBtn" type="button">Reset</button>
    </div>

    <div id="result" class="result">Ready âœ…</div>

    <div class="tiny">
      Probability: <span class="pill">10 & 20 = 99.99%</span>
      <br/>Rare: 30/40/50/100/500 (bahut kam chance)
    </div>
  </div>

<script>
  // --------- CONFIG ----------
  const prizes = [10, 20, 30, 40, 50, 100, 500];

  // 99.99% chance for 10 & 20. Remaining 0.01% among rest.
  // Total = 1.0
  const weights = {
    10: 0.55,     // 55%
    20: 0.4499,   // 44.99%  => total 99.99%
    30: 0.00002,  // 0.002%
    40: 0.00002,
    50: 0.00002,
    100:0.00001,
    500:0.00001
  };

  // Visual colors: blue/white segments + red outer border
  const COLORS = ["#ffffff", "#dbeafe"]; // white, light blue
  const TEXT_COLOR = "#0b3ea8";

  // --------- STATE ----------
  const canvas = document.getElementById("wheel");
  const ctx = canvas.getContext("2d");
  const resultEl = document.getElementById("result");
  const spinBtn = document.getElementById("spinBtn");
  const resetBtn = document.getElementById("resetBtn");

  const cx = canvas.width / 2;
  const cy = canvas.height / 2;
  const R = 250;

  const N = prizes.length;
  const segAngle = (Math.PI * 2) / N;

  // rotation: radians, 0 means segment 0 starts at angle 0 (to the right)
  // our pointer/arrow is at TOP. Angle of TOP in canvas is -90deg.
  let rotation = 0;
  let spinning = false;

  drawWheel();

  // --------- RANDOM (better than Math.random) ----------
  function rand01(){
    const a = new Uint32Array(1);
    crypto.getRandomValues(a);
    return a[0] / 4294967296; // 0..1
  }

  function weightedPick(){
    const r = rand01();
    let acc = 0;
    for (const p of prizes){
      acc += weights[p] ?? 0;
      if (r <= acc) return p;
    }
    // fallback due to float rounding
    return 10;
  }

  // --------- GEOMETRY: Make wheel stop EXACTLY on target under the arrow ----------
  // Arrow is at TOP => angleTop = -PI/2 in canvas coordinates.
  // For a given rotation, the segment "i" center angle in world space is:
  // center = rotation + i*segAngle + segAngle/2
  // We want center == angleTop (mod 2PI). So solve rotationTarget.
  function rotationForPrize(prize){
    const i = prizes.indexOf(prize);
    const angleTop = -Math.PI / 2;

    // targetRotation â‰¡ angleTop - (i*segAngle + segAngle/2)  (mod 2PI)
    let target = angleTop - (i * segAngle + segAngle / 2);

    // Normalize target to [0, 2PI)
    target = ((target % (Math.PI*2)) + (Math.PI*2)) % (Math.PI*2);
    return target;
  }

  // For "nice" landing (not always exact same place), add a tiny random offset
  // but keep it inside the same segment so prize doesn't change.
  function addSafeJitter(targetRot){
    const maxJitter = segAngle * 0.18; // 18% of segment width
    const jitter = (rand01() * 2 - 1) * maxJitter;
    return targetRot + jitter;
  }

  // --------- ANIMATION (accelerate -> steady -> slow) ----------
  // We animate rotation from current rotation to finalRotation using a piecewise easing.
  function easePiecewise(t){
    // t: 0..1
    // 0-0.18: ease-in (accel)
    // 0.18-0.70: linear-ish (steady)
    // 0.70-1: ease-out (slow)
    if (t < 0.18){
      const x = t / 0.18;
      return x * x; // ease in quad
    }
    if (t < 0.70){
      const x = (t - 0.18) / (0.70 - 0.18);
      // map from 0.18 phase end to something smooth
      // Start value at end of first phase = 1
      // We'll blend: 1 + x * k
      return 1 + x * 2.2; // steady growth
    }
    // ease-out
    const x = (t - 0.70) / 0.30;
    const easeOut = 1 - Math.pow(1 - x, 3); // cubic
    return 3.2 + easeOut * 1.8;
  }

  function spin(){
    if (spinning) return;

    // Decide prize FIRST (reliable) then animate to land there
    const prize = weightedPick();

    spinning = true;
    spinBtn.disabled = true;
    resultEl.textContent = "Spinning... ðŸŽ¯";

    const startRot = rotation;

    // Compute exact target rotation (mod 2PI), plus jitter
    let targetRot = rotationForPrize(prize);
    targetRot = addSafeJitter(targetRot);

    // We also want multiple full spins for fun
    const extraSpins = 6 + Math.floor(rand01() * 3); // 6-8 rounds
    const twoPi = Math.PI * 2;

    // Current rotation mod 2PI
    const startMod = ((startRot % twoPi) + twoPi) % twoPi;

    // delta to reach target from current (forward direction)
    let delta = targetRot - startMod;
    if (delta < 0) delta += twoPi;

    // Final rotation in absolute radians
    const finalRot = startRot + extraSpins * twoPi + delta;

    const duration = 4200 + Math.floor(rand01() * 700); // 4.2s - 4.9s
    const t0 = performance.now();

    function frame(now){
      const t = Math.min(1, (now - t0) / duration);

      // Use piecewise curve but normalize to 0..1 movement:
      // We map easePiecewise(t) into a 0..1 by dividing by final value.
      const endVal = easePiecewise(1);
      const prog = easePiecewise(t) / endVal;

      rotation = startRot + (finalRot - startRot) * prog;

      drawWheel();

      if (t < 1){
        requestAnimationFrame(frame);
      } else {
        // Snap EXACTLY to final rotation (prevents 1px error)
        rotation = finalRot;
        drawWheel();

        // Show prize
        resultEl.textContent = `You won: ${prize} coins ðŸª™`;
        spinning = false;
        spinBtn.disabled = false;
      }
    }

    requestAnimationFrame(frame);
  }

  function reset(){
    rotation = 0;
    resultEl.textContent = "Ready âœ…";
    drawWheel();
  }

  spinBtn.addEventListener("click", spin);
  resetBtn.addEventListener("click", reset);

  // --------- DRAWING ----------
  function drawWheel(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // background circle shadow
    ctx.save();
    ctx.beginPath();
    ctx.arc(cx, cy, R+12, 0, Math.PI*2);
    ctx.fillStyle = "rgba(0,0,0,0.06)";
    ctx.fill();
    ctx.restore();

    // segments
    for (let i=0; i<N; i++){
      const start = rotation + i * segAngle;
      const end   = start + segAngle;

      // slice
      ctx.beginPath();
      ctx.moveTo(cx, cy);
      ctx.arc(cx, cy, R, start, end);
      ctx.closePath();
      ctx.fillStyle = COLORS[i % 2];
      ctx.fill();

      // thin divider line
      ctx.strokeStyle = "rgba(11,102,255,0.25)";
      ctx.lineWidth = 3;
      ctx.stroke();

      // text (coins)
      const mid = (start + end) / 2;
      ctx.save();
      ctx.translate(cx, cy);
      ctx.rotate(mid);
      ctx.textAlign = "right";
      ctx.fillStyle = TEXT_COLOR;
      ctx.font = "bold 30px Arial";
      ctx.fillText(`${prizes[i]}`, R - 26, 10);
      ctx.font = "bold 18px Arial";
      ctx.fillText("coins", R - 26, 34);
      ctx.restore();
    }

    // outer red border
    ctx.beginPath();
    ctx.arc(cx, cy, R, 0, Math.PI*2);
    ctx.strokeStyle = "#ef4444";
    ctx.lineWidth = 14;
    ctx.stroke();

    // inner ring
    ctx.beginPath();
    ctx.arc(cx, cy, 80, 0, Math.PI*2);
    ctx.fillStyle = "#ffffff";
    ctx.fill();
    ctx.strokeStyle = "#0b66ff";
    ctx.lineWidth = 8;
    ctx.stroke();

    // center cap
    ctx.beginPath();
    ctx.arc(cx, cy, 22, 0, Math.PI*2);
    ctx.fillStyle = "#111827";
    ctx.fill();

    // small top marker dot near border (for visual)
    ctx.beginPath();
    ctx.arc(cx, cy - (R - 8), 6, 0, Math.PI*2);
    ctx.fillStyle = "#111827";
    ctx.fill();
  }

  // Optional: protect page (if you used login system)
  // if (localStorage.getItem("isLoggedIn") !== "yes") window.location.href = "login.html";
</script>
</body>
</html>

